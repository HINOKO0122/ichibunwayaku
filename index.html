<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Line-by-Line Translator</title>
    <style>
        body { font-family: sans-serif; padding-bottom: 100px; }
        #output div { margin-bottom: 10px; padding: 5px; border-bottom: 1px dotted #ccc; }
        
        /* ボタンを押している間の表示切り替え */
        .translation { display: none; color: blue; }
        body.show-translation .original { display: none; }
        body.show-translation .translation { display: block; }

        /* 下部固定ボタン */
        .footer-btn {
            position: fixed; bottom: 20px; left: 50%;
            transform: translateX(-50%);
            padding: 15px 30px; font-size: 1.2rem;
            background: #007bff; color: white; border: none;
            border-radius: 50px; cursor: pointer; user-select: none;
        }
    </style>
</head>
<body>

    <textarea id="input" rows="10" style="width:100%" placeholder="英文を貼り付けてください"></textarea>
    <button onclick="processText()">分割して表示</button>

    <div id="output"></div>

    <button id="translateBtn" class="footer-btn">押している間だけ和訳</button>

    <script>
       async function processText() {
    const input = document.getElementById('input').value;
    const output = document.getElementById('output');
    const gasUrl = "あなたのGASのURL"; 

    // すでに保存されているか確認（簡易的な節約機能）
    const cache = localStorage.getItem(btoa(input).substring(0, 20));
    if (cache) {
        output.innerHTML = cache;
        return;
    }

    output.innerHTML = '翻訳中...（まとめて翻訳して節約しています）';

    try {
        // 全文をまとめてGASに送信（通信は1回だけ！）
        const response = await fetch(`${gasUrl}?text=${encodeURIComponent(input)}`);
        const fullTranslatedText = await response.text();

        const originalLines = input.split('\n');
        const translatedLines = fullTranslatedText.split('\n');

        let htmlContent = '';
        originalLines.forEach((line, i) => {
            if (line.trim() === "") return;
            htmlContent += `
                <div>
                    <span class="original">${line}</span>
                    <span class="translation">${translatedLines[i] || ''}</span>
                </div>
            `;
        });

        output.innerHTML = htmlContent;
        // 結果をブラウザに一時保存
        localStorage.setItem(btoa(input).substring(0, 20), htmlContent);

    } catch (e) {
        output.innerHTML = 'エラーが発生しました。';
    }
}

        const btn = document.getElementById('translateBtn');
        // マウス/タッチ操作でクラスを切り替え
        const toggleOn = () => document.body.classList.add('show-translation');
        const toggleOff = () => document.body.classList.remove('show-translation');

        btn.addEventListener('mousedown', toggleOn);
        btn.addEventListener('mouseup', toggleOff);
        btn.addEventListener('touchstart', toggleOn);
        btn.addEventListener('touchend', toggleOff);
    </script>
</body>
</html>
